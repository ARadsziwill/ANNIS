<build 
       xmlns:sh="http://bitten.edgewall.org/tools/sh"
       xmlns:python="http://bitten.edgewall.org/tools/python" 
       xmlns:svn="http://bitten.edgewall.org/tools/svn"
       xmlns:java="http://bitten.edgewall.org/tools/java">

  <step id="checkout" description="Checkout source from repository">
    <!-- the revision will be in the form "trunk,636", so use sed to get the real revision number from this string -->
    <sh:exec file="/usr/local/bin/checkout_bzr_annis.sh" args="${path} ${revision} /srv/bzr/annis/${path} ${basedir}" />
  </step>

  <step id="build all" description="Build all maven based annis projects">
    <sh:exec file="/usr/bin/mvn" args="-f pom.xml -Dmaven.test.skip=true install" />
  </step>

  <step id="service distribution" description="Package the service distribution">
    <sh:exec file="/usr/bin/mvn" args="-f Annis-Service/pom.xml -Dmaven.test.skip=true assembly:assembly" />
  </step>

  <step id="stop service" description="Stop the AnnisService">
    <sh:exec file="chmod" args="u+x buildbot_scripts/stopService.sh" />
    <sh:exec file="buildbot_scripts/stopService.sh" args="/opt/annis/trunk" />
  </step>

  
  <step id="copy webapp" description="Copy the Annis2-webapp">
   <sh:exec file="chmod" args="u+x buildbot_scripts/copyWebapp.sh" /> 
   <sh:exec file="buildbot_scripts/copyWebapp.sh" args="/srv/tomcat/Annis-trunk"/>
  </step>

  <step id="patch webapp" description="Patch the Annis2-webapp with some korpling relative configuration">
    <python:exec file="buildbot_scripts/patchWebapp.py" args="/srv/tomcat/Annis-trunk ${revision} /etc/annis/user_config_trunk"/>
  </step>

  <step id="copy service" description="Copy the AnnisService">
    <sh:exec file="chmod" args="u+x buildbot_scripts/copyService.sh" />
    <sh:exec file="buildbot_scripts/copyService.sh" args="/opt/annis/trunk"/>
  </step>

  <step id="start service" description="Start the AnnisService">
    <sh:exec file="chmod" args="u+x buildbot_scripts/startService.sh" />
    <sh:exec file="buildbot_scripts/startService.sh" args="/opt/annis/trunk" />
  </step>

</build>


